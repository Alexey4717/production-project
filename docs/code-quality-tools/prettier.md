# Prettier — автоматическое форматирование кода

## Зачем нужен Prettier?

Prettier — это инструмент для автоматического форматирования кода.
В отличие от линтера (ESLint), который отвечает за статический анализ и соблюдение правил кода,
Prettier занимается исключительно визуальным оформлением: отступы, кавычки, запятые, пробелы и т.д.
Это устраняет ненужные споры в команде и позволяет сфокусироваться на логике, а не на пробелах.

----

## Установка и настройка

Установим Prettier как dev-зависимость:

```bash
npm install --save-dev prettier
```

Создадим конфигурационный файл .prettierrc.json, пример:

```bash
{
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "semi": true,
  "singleQuote": true,
  "trailingComma": "all",
  "bracketSpacing": true,
  "bracketSameLine": false,
  "arrowParens": "always"
}
```

Создаём .prettierignore, чтобы исключить из форматирования лишние файлы, пример содержимого:

```bash
**/node_modules
**/dist
**/build
**/coverage
*.md
*.json
```

----

## Интеграция с ESLint

Часто Prettier используется вместе с ESLint, чтобы убрать конфликты между правилами линтера и форматтера.

Установим нужный пакет:

```bash
npm install --save-dev eslint-config-prettier
```

И добавим prettier в extends в файле .eslintrc.js:

```bash
module.exports = {
  extends: [
    'some-other-config',
    'prettier' // ДОЛЖЕН БЫТЬ ПОСЛЕДНИМ в массиве
  ]
}
```

Правила всегда побеждают extends (т.е. они приоритетнее чем расширение какого-то конфига).
Поэтому от ненужных правил нужно избавиться или переопределить.

eslint-config-prettier отключает все правила ESLint, которые могут конфликтовать с Prettier.
Также желательно удалить или переопределить некоторые правила в ESLint, например:

```bash
rules: {
  'indent': 'off',
  'max-len': 'off',
}
```

Так же должна быть интеграция со stylelint.

### Варианты работы с преттиром в Lint-staged

1. Автоматически форматирует файлы и сохраняет изменения. Не прерывает процесс коммита.

```bash
prettier --write
```

Когда использовать:

- Когда хотите автоматически исправлять форматирование
- В проектах, где все согласны с автоматическим форматированием
- Для быстрого приведения кода к единому стилю

2. Только проверяет форматирование, но не изменяет файлы. Прерывает процесс коммита при ошибке.

```bash
prettier --list-different  // работает медленее, но выводит проблемные файлы
prettier --check           // работает быстрее, но выводит только статистику
```

Когда использовать:

- Когда хотите явно контролировать процесс форматирования
- В проектах, где важно ручное подтверждение изменений стиля
- Для CI/CD, где нужно только валидировать форматирование

3. Комбинация

```bash
"*.{js,ts}": [
  "prettier --write",
  "eslint --fix --max-warnings=0"
]
```

Порядок имеет значение - сначала Prettier, потом ESLint (Prettier может ломать некоторые ESLint правила).

----

## Подсказка для WebStorm / VS Code

1. В WebStorm включите интеграцию с Prettier:

- Settings → Languages & Frameworks → JavaScript → Prettier
- Включите On code reformat и On save
- Убедитесь, что выбрана опция Automatic config search

2. В VS Code:

- Установите плагин Prettier – Code Formatter
- Включите Format on Save в настройках.

Горячие клавиши авто форматирования (Webstorm):

- Windows/Linux: Ctrl + Alt + L
- MacOS: Option + Command + L

----

## Типичные настройки Prettier

Ниже представлены часто используемые настройки Prettier и их описание:

| Настройка        | Описание                                                                 |
|------------------|--------------------------------------------------------------------------|
| `tabWidth`       | Количество пробелов, используемых для табуляции. Обычно `2`.            |
| `semi`           | Добавлять точку с запятой в конце каждой строки. `true` — рекомендуется.|
| `singleQuote`    | Использовать одинарные кавычки вместо двойных.                          |
| `trailingComma`  | Добавлять запятые в конце объектов и массивов. `all` — рекомендуется.   |
| `bracketSpacing` | Добавлять пробелы внутри фигурных скобок `{ foo: bar }`.                |
| `bracketSameLine`| Оставлять `>` у JSX-тегов на той же строке. `false` — переносить.       |
| `arrowParens`    | Оборачивать аргументы стрелочных функций в скобки. `always` — читаемо.  |

Полный список параметров — на [сайте](https://prettier.io/docs/en/options.html)

----

## Возможные проблемы

Если не сработал скрипт 

```bash
yarn exec prettier . --write 
```

Попробуйте использовать npx:

```bash
npx prettier . --write
```

Иногда IDE может "забыть" форматировать код. В таком случае:

- Перезапустите IDE
- Выключите и снова включите Prettier в настройках

Иногда IDE не может автоматически определить нужный конфиг и его нужно самостоятельно указать.
Особенно актуально, если работа в отдельном пакете монорепы.
Обычно пакеты доступны через workspaces (например через lerna), тогда конфиг берется из корня монорепы.
Но возможно переопределение конфига (и линтера, и преттира) в отдельном пакете (для него так же нужно будет определять плагин для работы с линтером, но отдельно устанавливать зависимости не нужно).

----

## Дополнительно

Добавили в ESLint правило:

```bash
'react/jsx-max-props-per-line': [1, { maximum: 3 }],
```

Чтобы в JSX не было больше 3 пропсов на одну строку — это улучшает читаемость и дополняет конфигурацию Prettier.

